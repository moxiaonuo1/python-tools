<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç©è½¬Pythonï¼šæœ¬å­¦æœŸçŸ¥è¯†åœ°å›¾å›é¡¾</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Highlight.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&family=Fira+Code:wght@400;500&display=swap');
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #f8fafc; /* Slate-50 */
            background-image: radial-gradient(#e2e8f0 2px, transparent 2px);
            background-size: 30px 30px;
        }

        .code-font {
            font-family: 'Fira Code', monospace;
        }

        .card-hover {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .modal-enter {
            animation: modalIn 0.3s ease-out forwards;
        }
        
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .icon-box {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 56px;
            height: 56px;
            border-radius: 12px;
            font-size: 24px;
            margin-bottom: 12px;
            transition: all 0.5s ease;
        }

        /* Quiz Option Styles */
        .quiz-option {
            transition: all 0.2s;
            cursor: pointer;
            border: 2px solid #e2e8f0;
        }
        .quiz-option:hover {
            border-color: #94a3b8;
            background-color: #f1f5f9;
        }
        .quiz-correct {
            background-color: #dcfce7 !important;
            border-color: #22c55e !important;
            color: #15803d;
        }
        .quiz-wrong {
            background-color: #fee2e2 !important;
            border-color: #ef4444 !important;
            color: #b91c1c;
        }
        .answered {
            pointer-events: none;
            opacity: 0.9;
        }

        /* Module Completed Animation */
        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            80% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .badge-pop {
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* Unlocked Card Style */
        .card-unlocked {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            border: none;
            color: white;
            animation: pulse-glow 3s infinite;
        }
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0 0 rgba(249, 115, 22, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(249, 115, 22, 0); }
            100% { box-shadow: 0 0 0 0 rgba(249, 115, 22, 0); }
        }

        /* Custom Scrollbar */
        .modal-scroll::-webkit-scrollbar, .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .modal-scroll::-webkit-scrollbar-track, .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e293b; /* Dark track for dark mode */
        }
        .modal-scroll::-webkit-scrollbar-thumb, .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #475569; /* Dark thumb for dark mode */
        }

        /* Hackathon Modal Specifics */
        .cursor-blink {
            animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        .tab-active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .tab-inactive {
            background-color: #1e293b;
            color: #94a3b8;
            border-color: #334155;
        }
        .tab-inactive:hover {
            background-color: #334155;
            color: #e2e8f0;
        }
    </style>
</head>
<body class="text-slate-800 min-h-screen flex flex-col">

    <!-- Hero Section -->
    <header class="bg-white/90 backdrop-blur-md border-b border-slate-200 sticky top-0 z-20 shadow-sm">
        <div class="w-full px-6 md:px-10 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-xl shadow-md cursor-pointer hover:bg-indigo-700 transition-colors" onclick="location.reload()">Py</div>
                <div>
                    <h1 class="text-xl font-bold text-slate-800">ç©è½¬Python çŸ¥è¯†å›é¡¾ <span class="text-xs font-normal text-slate-500 ml-2 hidden sm:inline">Review & Challenge</span></h1>
                </div>
            </div>
            <div id="header-badge" class="text-xs font-semibold text-indigo-600 bg-indigo-50 px-3 py-1.5 rounded-full border border-indigo-100 whitespace-nowrap">
                ğŸ“š çŸ¥è¯†ç‚¹å¤ä¹ æ¨¡å¼
            </div>
        </div>
    </header>

    <!-- Main Content Container -->
    <main class="w-full px-6 md:px-10 py-8 flex-grow relative z-10 flex flex-col">
        
        <!-- View 1: Knowledge Map -->
        <div id="map-view" class="w-full">
            <div class="flex flex-col md:flex-row justify-between items-end mb-8 border-b border-slate-200 pb-4">
                <div>
                    <h2 class="text-3xl font-bold mb-2 text-slate-800">å­¦ä¹ åœ°å›¾</h2>
                    <p class="text-slate-600">ç‚¹å‡»å¡ç‰‡å¤ä¹ ï¼Œç‚¹äº®æ‰€æœ‰æŠ€èƒ½ï¼Œå¼€å¯æœ€ç»ˆæŒ‘æˆ˜ï¼</p>
                </div>
                <div class="mt-4 md:mt-0 flex items-center gap-3">
                    <span class="text-xs text-slate-400 font-bold uppercase tracking-wider">å½“å‰è¿›åº¦</span>
                    <div class="flex gap-1.5" id="progress-dots">
                        <div class="w-3 h-3 rounded-full bg-slate-200 dot-1 transition-colors duration-300"></div>
                        <div class="w-3 h-3 rounded-full bg-slate-200 dot-2 transition-colors duration-300"></div>
                        <div class="w-3 h-3 rounded-full bg-slate-200 dot-3 transition-colors duration-300"></div>
                        <div class="w-3 h-3 rounded-full bg-slate-200 dot-4 transition-colors duration-300"></div>
                        <div class="w-3 h-3 rounded-full bg-slate-200 dot-5 transition-colors duration-300"></div>
                    </div>
                </div>
            </div>

            <!-- Cards Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-6 w-full">
                <!-- Module 1 -->
                <div id="module-card-1" class="card-hover bg-white p-6 rounded-xl shadow-sm border border-slate-100 cursor-pointer group relative h-full flex flex-col" onclick="openModal(1)">
                    <div class="flex justify-between items-start mb-4">
                        <div class="icon-box bg-blue-50 text-blue-600 group-hover:bg-blue-600 group-hover:text-white transition-colors"><i class="fa-solid fa-cube"></i></div>
                        <span class="text-xs font-bold text-slate-300">01</span>
                    </div>
                    <div class="flex-grow">
                        <h3 class="text-lg font-bold mb-1">åŸºç¡€ç§¯æœ¨</h3>
                        <p class="text-slate-500 text-sm">å˜é‡ / æ•°æ®ç±»å‹ / è¾“å…¥è¾“å‡º</p>
                    </div>
                    <div class="mt-6 pt-4 border-t border-slate-50 text-xs text-blue-600 font-medium flex items-center footer-text">å¼€å§‹å¤ä¹  <i class="fa-solid fa-arrow-right ml-2"></i></div>
                </div>
                <!-- Module 2 -->
                <div id="module-card-2" class="card-hover bg-white p-6 rounded-xl shadow-sm border border-slate-100 cursor-pointer group relative h-full flex flex-col" onclick="openModal(2)">
                    <div class="flex justify-between items-start mb-4">
                        <div class="icon-box bg-purple-50 text-purple-600 group-hover:bg-purple-600 group-hover:text-white transition-colors"><i class="fa-solid fa-code-branch"></i></div>
                        <span class="text-xs font-bold text-slate-300">02</span>
                    </div>
                    <div class="flex-grow">
                        <h3 class="text-lg font-bold mb-1">é€»è¾‘æ§åˆ¶</h3>
                        <p class="text-slate-500 text-sm">if åˆ¤æ–­ / é€»è¾‘è¿ç®— / Match</p>
                    </div>
                    <div class="mt-6 pt-4 border-t border-slate-50 text-xs text-purple-600 font-medium flex items-center footer-text">å¼€å§‹å¤ä¹  <i class="fa-solid fa-arrow-right ml-2"></i></div>
                </div>
                <!-- Module 3 -->
                <div id="module-card-3" class="card-hover bg-white p-6 rounded-xl shadow-sm border border-slate-100 cursor-pointer group relative h-full flex flex-col" onclick="openModal(3)">
                    <div class="flex justify-between items-start mb-4">
                        <div class="icon-box bg-amber-50 text-amber-600 group-hover:bg-amber-600 group-hover:text-white transition-colors"><i class="fa-solid fa-layer-group"></i></div>
                        <span class="text-xs font-bold text-slate-300">03</span>
                    </div>
                    <div class="flex-grow">
                        <h3 class="text-lg font-bold mb-1">æ•°æ®å®¹å™¨</h3>
                        <p class="text-slate-500 text-sm">List / Tuple / Dict / Set</p>
                    </div>
                    <div class="mt-6 pt-4 border-t border-slate-50 text-xs text-amber-600 font-medium flex items-center footer-text">å¼€å§‹å¤ä¹  <i class="fa-solid fa-arrow-right ml-2"></i></div>
                </div>
                <!-- Module 4 -->
                <div id="module-card-4" class="card-hover bg-white p-6 rounded-xl shadow-sm border border-slate-100 cursor-pointer group relative h-full flex flex-col" onclick="openModal(4)">
                    <div class="flex justify-between items-start mb-4">
                        <div class="icon-box bg-emerald-50 text-emerald-600 group-hover:bg-emerald-600 group-hover:text-white transition-colors"><i class="fa-solid fa-wand-magic-sparkles"></i></div>
                        <span class="text-xs font-bold text-slate-300">04</span>
                    </div>
                    <div class="flex-grow">
                        <h3 class="text-lg font-bold mb-1">å‡½æ•°é­”æ³•</h3>
                        <p class="text-slate-500 text-sm">def / å‚æ•° / è¿”å›å€¼</p>
                    </div>
                    <div class="mt-6 pt-4 border-t border-slate-50 text-xs text-emerald-600 font-medium flex items-center footer-text">å¼€å§‹å¤ä¹  <i class="fa-solid fa-arrow-right ml-2"></i></div>
                </div>
                <!-- Module 5 -->
                <div id="module-card-5" class="card-hover bg-white p-6 rounded-xl shadow-sm border border-slate-100 cursor-pointer group relative h-full flex flex-col" onclick="openModal(5)">
                    <div class="flex justify-between items-start mb-4">
                        <div class="icon-box bg-rose-50 text-rose-600 group-hover:bg-rose-600 group-hover:text-white transition-colors"><i class="fa-solid fa-rotate"></i></div>
                        <span class="text-xs font-bold text-slate-300">05</span>
                    </div>
                    <div class="flex-grow">
                        <h3 class="text-lg font-bold mb-1">å¾ªç¯ä¸ç®—æ³•</h3>
                        <p class="text-slate-500 text-sm">For / While / é€’å½’</p>
                    </div>
                    <div class="mt-6 pt-4 border-t border-slate-50 text-xs text-rose-600 font-medium flex items-center footer-text">å¼€å§‹å¤ä¹  <i class="fa-solid fa-arrow-right ml-2"></i></div>
                </div>
                <!-- Module 6 (Final Challenge) -->
                <div id="module-card-6" class="card-hover card-unlocked p-6 rounded-xl shadow-sm cursor-pointer group flex flex-col items-center justify-center text-center relative overflow-hidden h-full min-h-[220px]" onclick="showMarathon()">
                    <div id="lock-icon" class="w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-lg mb-6 z-10 transition-transform duration-500 transform group-hover:rotate-12 group-hover:scale-110">
                        <i class="fa-solid fa-rocket text-3xl text-orange-500"></i>
                    </div>
                    <h3 id="lock-title" class="text-2xl font-bold text-white z-10 mb-2">Python åˆ›å®¢é©¬æ‹‰æ¾</h3>
                    <div class="inline-block bg-white/20 backdrop-blur-sm rounded-full px-4 py-1 z-10">
                        <p id="lock-text" class="text-white text-xs font-bold uppercase tracking-wider">å¼€å¯æŒ‘æˆ˜ ğŸš€</p>
                    </div>
                    <div class="absolute inset-0 bg-gradient-to-tr from-white/0 via-white/10 to-white/0 opacity-0 group-hover:opacity-100 transition-opacity duration-700 z-0"></div>
                </div>
            </div>
        </div>

        <!-- View 2: Marathon View (Hidden initially) -->
        <div id="marathon-view" class="hidden fade-in w-full">
            
            <!-- Compact Header Row -->
            <div class="flex flex-col md:flex-row justify-between items-center md:items-end mb-6 gap-4 border-b border-slate-200 pb-4">
                <div class="flex items-center gap-4">
                    <button onclick="hideMarathon()" class="text-slate-400 hover:text-indigo-600 transition-colors bg-white p-2 rounded-full shadow-sm border border-slate-100" title="è¿”å›">
                        <i class="fa-solid fa-arrow-left text-xl"></i>
                    </button>
                    <div>
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">ğŸ”¥</span>
                            <h2 class="text-3xl font-bold text-slate-800">Python åˆ›å®¢é©¬æ‹‰æ¾</h2>
                            
                            <!-- Hidden Console Icon (Opens with Code) -->
                            <button onclick="openHackathonModal('adventure', true)" class="text-slate-300 hover:text-slate-600 hover:bg-slate-100 transition-all p-2 rounded-full relative group" title="ä»»åŠ¡æ§åˆ¶å° & æ¼”ç¤º">
                                <i class="fa-solid fa-terminal text-lg"></i>
                                <span class="absolute -top-1 -right-1 flex h-2.5 w-2.5">
                                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-sky-400 opacity-75"></span>
                                  <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-sky-500"></span>
                                </span>
                                <span class="absolute left-full ml-2 top-1/2 -translate-y-1/2 bg-slate-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none z-50 shadow-lg">ç‚¹å‡»æ‰“å¼€ä»£ç æ¼”ç¤ºå°</span>
                            </button>

                        </div>
                        <p class="text-slate-500 text-sm mt-1">Code Your World. æŒ‘é€‰ä»»åŠ¡ï¼Œç”¨ä»£ç å®šä¹‰ä½ çš„ä¸–ç•Œï¼</p>
                    </div>
                </div>

                <!-- Compact Requirements Box -->
                <div class="bg-indigo-50 border border-indigo-100 rounded-lg py-2 px-4 text-xs md:text-sm text-indigo-800 flex flex-wrap gap-x-6 gap-y-2 items-center shadow-sm">
                    <span class="font-bold mr-1 bg-indigo-100 px-2 py-0.5 rounded text-indigo-900"><i class="fa-solid fa-list-check"></i> è¦æ±‚</span>
                    <span class="flex items-center"><i class="fa-solid fa-check mr-1.5 text-indigo-500"></i> >50è¡Œä»£ç </span>
                    <span class="flex items-center"><i class="fa-solid fa-check mr-1.5 text-indigo-500"></i> 2+è‡ªå®šä¹‰å‡½æ•°</span>
                    <span class="flex items-center"><i class="fa-solid fa-check mr-1.5 text-indigo-500"></i> List/Dictå­˜å‚¨</span>
                    <span class="flex items-center"><i class="fa-solid fa-check mr-1.5 text-indigo-500"></i> Inputäº¤äº’</span>
                </div>
            </div>

            <!-- Detailed Cards Grid (Restored Version) -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 w-full">
                
                <!-- Project 1 -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-slate-200 hover:shadow-lg transition-all duration-300 flex flex-col h-full group">
                    <div class="bg-slate-800 p-4 text-white relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl transform rotate-12 transition-transform group-hover:scale-110 group-hover:rotate-6">ğŸ°</div>
                        <div class="flex justify-between items-start relative z-10">
                            <div class="bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                                <span class="text-2xl">ğŸ°</span>
                            </div>
                            <span class="bg-slate-700/80 backdrop-blur-sm text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide border border-slate-600">éš¾åº¦: â­â­</span>
                        </div>
                        <h3 class="text-lg font-bold mt-3 relative z-10">æ–‡å­—å†’é™©æ¸¸æˆ</h3>
                        <p class="text-slate-400 text-xs relative z-10">Text Adventure Game</p>
                    </div>
                    <div class="p-5 flex-grow flex flex-col justify-between">
                        <div>
                            <p class="text-slate-600 mb-4 text-sm leading-relaxed">
                                è®¾è®¡ä¸€ä¸ªäº’åŠ¨æ•…äº‹ã€‚ç©å®¶åœ¨æ£®æ—/å¤å ¡ä¸­æ¢é™©ï¼Œæ ¹æ®è¾“å…¥ï¼ˆå¦‚â€œå‘å·¦èµ°â€ï¼‰è§¦å‘ä¸åŒçš„å‰§æƒ…åˆ†æ”¯ã€‚
                            </p>
                            <div class="flex flex-wrap gap-2 mb-4">
                                <span class="px-2 py-1 bg-purple-50 text-purple-700 text-xs rounded border border-purple-100 font-medium">If-Else</span>
                                <span class="px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded border border-blue-100 font-medium">Whileå¾ªç¯</span>
                            </div>
                        </div>
                        <button onclick="openHackathonModal('adventure', false)" class="w-full py-2 bg-slate-50 border border-slate-200 text-slate-700 rounded-lg text-sm font-bold hover:bg-slate-800 hover:text-white hover:border-slate-800 transition-all flex items-center justify-center gap-2 group-hover:bg-slate-100">
                            <i class="fa-solid fa-play"></i> æŸ¥çœ‹ä»»åŠ¡æ¼”ç¤º
                        </button>
                    </div>
                </div>

                <!-- Project 2 -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-slate-200 hover:shadow-lg transition-all duration-300 flex flex-col h-full group">
                    <div class="bg-amber-500 p-4 text-white relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl transform rotate-12 transition-transform group-hover:scale-110 group-hover:rotate-6">ğŸ“’</div>
                        <div class="flex justify-between items-start relative z-10">
                            <div class="bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                                <span class="text-2xl">ğŸ“’</span>
                            </div>
                            <span class="bg-amber-600/80 backdrop-blur-sm text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide border border-amber-400">éš¾åº¦: â­â­â­</span>
                        </div>
                        <h3 class="text-lg font-bold mt-3 relative z-10">ç¤¾å›¢/ç­çº§å°ç®¡å®¶</h3>
                        <p class="text-amber-100 text-xs relative z-10">The Manager</p>
                    </div>
                    <div class="p-5 flex-grow flex flex-col justify-between">
                        <div>
                            <p class="text-slate-600 mb-4 text-sm leading-relaxed">
                                å¼€å‘ä¸€ä¸ªä¿¡æ¯ç®¡ç†ç³»ç»Ÿã€‚å¦‚èƒŒå•è¯æœ¬ã€è®°è´¦æœ¬æˆ–é€šè®¯å½•ï¼Œæ”¯æŒæ•°æ®çš„â€œå¢ã€åˆ ã€æ”¹ã€æŸ¥â€ã€‚
                            </p>
                            <div class="flex flex-wrap gap-2 mb-4">
                                <span class="px-2 py-1 bg-amber-50 text-amber-700 text-xs rounded border border-amber-100 font-medium">Dictå­—å…¸</span>
                                <span class="px-2 py-1 bg-emerald-50 text-emerald-700 text-xs rounded border border-emerald-100 font-medium">å‡½æ•°å°è£…</span>
                            </div>
                        </div>
                        <button onclick="openHackathonModal('manager', false)" class="w-full py-2 bg-slate-50 border border-slate-200 text-slate-700 rounded-lg text-sm font-bold hover:bg-amber-500 hover:text-white hover:border-amber-500 transition-all flex items-center justify-center gap-2 group-hover:bg-slate-100">
                            <i class="fa-solid fa-play"></i> æŸ¥çœ‹ä»»åŠ¡æ¼”ç¤º
                        </button>
                    </div>
                </div>

                <!-- Project 3 -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-slate-200 hover:shadow-lg transition-all duration-300 flex flex-col h-full group">
                    <div class="bg-rose-500 p-4 text-white relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl transform rotate-12 transition-transform group-hover:scale-110 group-hover:rotate-6">ğŸ¤–</div>
                        <div class="flex justify-between items-start relative z-10">
                            <div class="bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                                <span class="text-2xl">ğŸ¤–</span>
                            </div>
                            <span class="bg-rose-600/80 backdrop-blur-sm text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide border border-rose-400">éš¾åº¦: â­â­â­</span>
                        </div>
                        <h3 class="text-lg font-bold mt-3 relative z-10">ä¸ç”µè„‘åšå¼ˆ</h3>
                        <p class="text-rose-100 text-xs relative z-10">Game Master</p>
                    </div>
                    <div class="p-5 flex-grow flex flex-col justify-between">
                        <div>
                            <p class="text-slate-600 mb-4 text-sm leading-relaxed">
                                ç¼–å†™ä¸€ä¸ªé€»è¾‘æ¸¸æˆï¼Œå¦‚â€œçŒœæ•°å­—(è¿›é˜¶ç‰ˆ)â€ã€â€œçŸ³å¤´å‰ªåˆ€å¸ƒâ€æˆ–â€œäº•å­—æ£‹â€ã€‚å°è¯•å†™ä¸€ä¸ªç¬¨ç¬¨çš„AIå¯¹æ‰‹ã€‚
                            </p>
                            <div class="flex flex-wrap gap-2 mb-4">
                                <span class="px-2 py-1 bg-rose-50 text-rose-700 text-xs rounded border border-rose-100 font-medium">Random</span>
                                <span class="px-2 py-1 bg-purple-50 text-purple-700 text-xs rounded border border-purple-100 font-medium">é€»è¾‘åˆ¤æ–­</span>
                            </div>
                        </div>
                        <button onclick="openHackathonModal('game', false)" class="w-full py-2 bg-slate-50 border border-slate-200 text-slate-700 rounded-lg text-sm font-bold hover:bg-rose-500 hover:text-white hover:border-rose-500 transition-all flex items-center justify-center gap-2 group-hover:bg-slate-100">
                            <i class="fa-solid fa-play"></i> æŸ¥çœ‹ä»»åŠ¡æ¼”ç¤º
                        </button>
                    </div>
                </div>

                <!-- Project 4 -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-slate-200 hover:shadow-lg transition-all duration-300 flex flex-col h-full group">
                    <div class="bg-cyan-500 p-4 text-white relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl transform rotate-12 transition-transform group-hover:scale-110 group-hover:rotate-6">â„ï¸</div>
                        <div class="flex justify-between items-start relative z-10">
                            <div class="bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                                <span class="text-2xl">â„ï¸</span>
                            </div>
                            <span class="bg-cyan-600/80 backdrop-blur-sm text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide border border-cyan-400">éš¾åº¦: â­â­â­â­</span>
                        </div>
                        <h3 class="text-lg font-bold mt-3 relative z-10">åˆ†å½¢è‰ºæœ¯ç”»å»Š</h3>
                        <p class="text-cyan-100 text-xs relative z-10">Fractal Artist</p>
                    </div>
                    <div class="p-5 flex-grow flex flex-col justify-between">
                        <div>
                            <p class="text-slate-600 mb-4 text-sm leading-relaxed">
                                åˆ©ç”¨ Turtle åº“å’Œé€’å½’å‡½æ•°ï¼Œç»˜åˆ¶å¤æ‚çš„å‡ ä½•å›¾å½¢ï¼Œå¦‚ç§‘èµ«é›ªèŠ±ã€è°¢å°”å®¾æ–¯åŸºä¸‰è§’å½¢æˆ–åˆ†å½¢æ ‘ã€‚
                            </p>
                            <div class="flex flex-wrap gap-2 mb-4">
                                <span class="px-2 py-1 bg-cyan-50 text-cyan-700 text-xs rounded border border-cyan-100 font-medium">Turtle</span>
                                <span class="px-2 py-1 bg-rose-50 text-rose-700 text-xs rounded border border-rose-100 font-medium">é€’å½’å‡½æ•°</span>
                            </div>
                        </div>
                        <button onclick="openHackathonModal('fractal', false)" class="w-full py-2 bg-slate-50 border border-slate-200 text-slate-700 rounded-lg text-sm font-bold hover:bg-cyan-500 hover:text-white hover:border-cyan-500 transition-all flex items-center justify-center gap-2 group-hover:bg-slate-100">
                            <i class="fa-solid fa-play"></i> æŸ¥çœ‹ä»»åŠ¡æ¼”ç¤º
                        </button>
                    </div>
                </div>

            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="w-full bg-slate-800 text-slate-400 py-4 text-center mt-auto relative z-10 border-t border-slate-700 shadow-inner text-xs">
        <div class="w-full px-6 md:px-10">
            <span class="font-medium hover:text-slate-300 transition-colors cursor-default">Code Your World with Python.</span>
        </div>
    </footer>

    <!-- Modal 1: Knowledge Quiz (Existing) -->
    <div id="modal-overlay" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4" onclick="closeModal()">
        <div id="modal-content" class="bg-white w-full max-w-5xl h-[85vh] rounded-2xl shadow-2xl overflow-hidden flex flex-col md:flex-row relative" onclick="event.stopPropagation()">
            <button onclick="closeModal()" class="absolute top-4 right-4 z-10 w-8 h-8 flex items-center justify-center bg-white/80 rounded-full hover:bg-slate-100 transition-colors text-slate-500"><i class="fa-solid fa-xmark"></i></button>
            <div id="quiz-panel-left" class="w-full md:w-3/5 bg-white p-8 overflow-y-auto modal-scroll border-r border-slate-100">
                <div class="mb-6"><span id="modal-badge" class="px-3 py-1 rounded-full text-xs font-bold bg-blue-100 text-blue-600">Module 01</span></div>
                <h2 id="modal-title" class="text-3xl font-bold text-slate-800 mb-6">åŸºç¡€ç§¯æœ¨</h2>
                <div class="space-y-8"><div id="modal-points"></div></div>
            </div>
            <div id="quiz-panel-right" class="w-full md:w-2/5 bg-slate-50 p-8 flex flex-col justify-center border-t md:border-t-0 md:border-l border-slate-200">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-2"><i class="fa-solid fa-bolt text-yellow-500"></i><h3 class="font-bold text-slate-700">çŸ¥è¯†ç‚¹è‡ªæµ‹</h3></div>
                        <span id="quiz-counter" class="text-xs font-bold text-slate-400 bg-slate-100 px-2 py-1 rounded">1/3</span>
                    </div>
                    <p id="quiz-question" class="text-lg font-medium text-slate-800 mb-6"></p>
                    <div id="quiz-options" class="space-y-3"></div>
                    <div id="quiz-feedback" class="mt-4 hidden p-3 rounded-lg text-sm"></div>
                    <button id="next-btn" onclick="nextQuestion()" class="hidden mt-4 w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">ä¸‹ä¸€é¢˜ <i class="fa-solid fa-arrow-right"></i></button>
                    <div id="quiz-completion" class="hidden text-center py-8">
                        <div class="text-4xl mb-3">ğŸ‰</div>
                        <h4 class="text-xl font-bold text-green-600 mb-2">é€šå…³æˆåŠŸï¼</h4>
                        <button onclick="closeModal()" class="mt-4 bg-slate-800 text-white px-6 py-2 rounded-full font-bold text-sm hover:bg-slate-700">è¿”å›åœ°å›¾</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- â˜…â˜…â˜… NEW: Hackathon Task Console Modal (Updated) â˜…â˜…â˜… -->
    <div id="hackathon-modal" class="fixed inset-0 bg-slate-900/90 backdrop-blur-md z-[60] hidden flex items-center justify-center" onclick="closeHackathonModal()">
        <div class="w-full h-full md:w-[95vw] md:h-[90vh] bg-[#0f172a] md:rounded-2xl shadow-2xl overflow-hidden flex flex-col border border-slate-700 relative text-slate-300" onclick="event.stopPropagation()">
            
            <!-- Modal Header -->
            <div class="bg-slate-800 border-b border-slate-700 p-4 flex justify-between items-center flex-shrink-0">
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-terminal text-blue-400 text-lg"></i>
                    <h2 class="text-lg font-bold text-white font-code">Python åˆ›å®¢æŒ‘æˆ˜å°</h2>
                </div>
                <button onclick="closeHackathonModal()" class="text-slate-400 hover:text-white px-3 py-1 hover:bg-slate-700 rounded transition-colors">
                    <i class="fa-solid fa-xmark text-lg"></i> å…³é—­ (ESC)
                </button>
            </div>

            <!-- Modal Content (Layout from Previous Task Page) -->
            <div class="flex flex-1 overflow-hidden">
                <!-- Sidebar -->
                <nav class="w-64 bg-[#0f172a] border-r border-slate-800 flex flex-col p-4 gap-2 flex-shrink-0 overflow-y-auto hidden md:flex">
                    <div class="text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-2 px-2">ä»»åŠ¡èœå•</div>
                    <button onclick="switchTab('adventure')" id="tab-adventure" class="tab-active w-full text-left px-3 py-2 rounded-lg border flex items-center gap-3 transition-all">
                        <span class="text-xl">ğŸ°</span> <div class="text-sm font-medium">æ–‡å­—å†’é™©</div>
                    </button>
                    <button onclick="switchTab('manager')" id="tab-manager" class="tab-inactive w-full text-left px-3 py-2 rounded-lg border flex items-center gap-3 transition-all">
                        <span class="text-xl">ğŸ“’</span> <div class="text-sm font-medium">ç¤¾å›¢ç®¡å®¶</div>
                    </button>
                    <button onclick="switchTab('game')" id="tab-game" class="tab-inactive w-full text-left px-3 py-2 rounded-lg border flex items-center gap-3 transition-all">
                        <span class="text-xl">ğŸ¤–</span> <div class="text-sm font-medium">ç”µè„‘åšå¼ˆ</div>
                    </button>
                    <button onclick="switchTab('fractal')" id="tab-fractal" class="tab-inactive w-full text-left px-3 py-2 rounded-lg border flex items-center gap-3 transition-all">
                        <span class="text-xl">â„ï¸</span> <div class="text-sm font-medium">åˆ†å½¢è‰ºæœ¯</div>
                    </button>
                </nav>

                <!-- Mobile Nav (Dropdown for small screens) -->
                <div class="md:hidden bg-slate-800 p-2 border-b border-slate-700">
                    <select onchange="switchTab(this.value)" class="w-full bg-slate-900 text-white p-2 rounded border border-slate-700">
                        <option value="adventure">ğŸ° æ–‡å­—å†’é™©æ¸¸æˆ</option>
                        <option value="manager">ğŸ“’ ç¤¾å›¢å°ç®¡å®¶</option>
                        <option value="game">ğŸ¤– ä¸ç”µè„‘åšå¼ˆ</option>
                        <option value="fractal">â„ï¸ åˆ†å½¢è‰ºæœ¯ç”»å»Š</option>
                    </select>
                </div>

                <!-- Main Area -->
                <div class="flex-1 flex flex-col md:flex-row overflow-hidden">
                    <!-- Code Section (Can be hidden) -->
                    <section id="code-panel" class="w-full md:w-1/2 flex flex-col border-b md:border-b-0 md:border-r border-slate-700 bg-[#282c34]">
                        <div class="bg-[#21252b] px-4 py-2 flex justify-between items-center border-b border-black/20 text-xs text-slate-500">
                            <span id="code-filename" class="font-code">task.py</span>
                            <span>ä»£ç é¢„è§ˆ (åªè¯»)</span>
                        </div>
                        <div class="flex-1 overflow-auto custom-scrollbar relative">
                            <pre><code class="language-python text-sm leading-relaxed" id="code-display"># ä»£ç åŠ è½½ä¸­...</code></pre>
                        </div>
                    </section>
                    <!-- Console/Demo Section (Can be full width) -->
                    <section id="demo-panel" class="w-full md:w-1/2 flex flex-col bg-[#0d1117] relative">
                        <div class="bg-slate-800/50 px-4 py-2 border-b border-slate-700 flex justify-between items-center text-xs text-slate-400">
                            <div class="font-bold flex items-center gap-2"><i class="fa-solid fa-terminal"></i> è¿è¡Œç»“æœ / ç»ˆç«¯</div>
                            <button onclick="resetCurrentDemo()" class="hover:text-white"><i class="fa-solid fa-rotate-right"></i> é‡ç½®</button>
                        </div>
                        <div class="flex-1 overflow-auto p-4 flex items-center justify-center font-code text-sm text-slate-300 custom-scrollbar relative" id="demo-container">
                            
                            <!-- 1. Adventure -->
                            <div id="demo-adventure" class="w-full h-full flex flex-col hidden">
                                <div id="adventure-log" class="flex-1 overflow-y-auto space-y-1 pb-4 custom-scrollbar"></div>
                                <div class="mt-2 border-t border-slate-700 pt-2 flex gap-2">
                                    <span class="text-green-500">>>></span>
                                    <input type="text" id="adventure-input" class="bg-transparent border-none outline-none text-white w-full" placeholder="è¾“å…¥å‘½ä»¤ (ä¾‹å¦‚: start)..." autocomplete="off">
                                </div>
                            </div>

                            <!-- 2. Manager -->
                            <div id="demo-manager" class="w-full h-full flex flex-col hidden">
                                <div class="flex-1 bg-[#1e293b] p-3 rounded-t-lg overflow-y-auto custom-scrollbar border border-slate-700">
                                    <pre id="mgr-output" class="whitespace-pre-wrap leading-relaxed text-amber-100 font-code"></pre>
                                </div>
                                <div class="bg-[#1e293b] p-3 rounded-b-lg border border-slate-700 border-t-0 flex flex-col gap-2">
                                    <div class="flex gap-2 items-center"><span class="text-blue-400 text-xs">add_member</span><input id="mgr-add-name" placeholder="å§“å" class="bg-slate-800 w-16 px-1 text-xs border border-slate-600 rounded text-center"><input id="mgr-add-role" placeholder="èŒåŠ¡" class="bg-slate-800 w-16 px-1 text-xs border border-slate-600 rounded text-center"><button onclick="mgrAdd()" class="text-xs bg-blue-600 px-2 rounded hover:bg-blue-700">æ‰§è¡Œ</button></div>
                                    <div class="flex gap-2 items-center"><span class="text-red-400 text-xs">del_member</span><input id="mgr-del-name" placeholder="å§“å" class="bg-slate-800 w-16 px-1 text-xs border border-slate-600 rounded text-center"><button onclick="mgrDelete()" class="text-xs bg-red-600 px-2 rounded hover:bg-red-700">æ‰§è¡Œ</button></div>
                                    <div class="flex gap-2 items-center"><span class="text-amber-400 text-xs">show_all()</span><button onclick="mgrShow()" class="text-xs bg-amber-600 px-2 rounded ml-auto hover:bg-amber-700">æ‰§è¡Œ</button></div>
                                </div>
                            </div>

                            <!-- 3. Game -->
                            <div id="demo-game" class="hidden flex flex-col items-center">
                                <div class="grid grid-cols-3 gap-2 bg-slate-700 p-2 rounded-lg mb-4">
                                    <div class="w-16 h-16 bg-slate-800 rounded flex items-center justify-center text-3xl font-bold cursor-pointer ttt-cell hover:bg-slate-700" onclick="gameMove(0)"></div>
                                    <div class="w-16 h-16 bg-slate-800 rounded flex items-center justify-center text-3xl font-bold cursor-pointer ttt-cell hover:bg-slate-700" onclick="gameMove(1)"></div>
                                    <div class="w-16 h-16 bg-slate-800 rounded flex items-center justify-center text-3xl font-bold cursor-pointer ttt-cell hover:bg-slate-700" onclick="gameMove(2)"></div>
                                    <div class="w-16 h-16 bg-slate-800 rounded flex items-center justify-center text-3xl font-bold cursor-pointer ttt-cell hover:bg-slate-700" onclick="gameMove(3)"></div>
                                    <div class="w-16 h-16 bg-slate-800 rounded flex items-center justify-center text-3xl font-bold cursor-pointer ttt-cell hover:bg-slate-700" onclick="gameMove(4)"></div>
                                    <div class="w-16 h-16 bg-slate-800 rounded flex items-center justify-center text-3xl font-bold cursor-pointer ttt-cell hover:bg-slate-700" onclick="gameMove(5)"></div>
                                    <div class="w-16 h-16 bg-slate-800 rounded flex items-center justify-center text-3xl font-bold cursor-pointer ttt-cell hover:bg-slate-700" onclick="gameMove(6)"></div>
                                    <div class="w-16 h-16 bg-slate-800 rounded flex items-center justify-center text-3xl font-bold cursor-pointer ttt-cell hover:bg-slate-700" onclick="gameMove(7)"></div>
                                    <div class="w-16 h-16 bg-slate-800 rounded flex items-center justify-center text-3xl font-bold cursor-pointer ttt-cell hover:bg-slate-700" onclick="gameMove(8)"></div>
                                </div>
                                <div id="game-status" class="text-white text-sm font-bold">ç©å®¶(X) vs ç”µè„‘(O)</div>
                            </div>

                            <!-- 4. Fractal -->
                            <div id="demo-fractal" class="hidden flex flex-col items-center justify-center w-full h-full">
                                <canvas id="fractal-canvas" width="300" height="300" class="bg-black rounded border border-slate-700 mb-4"></canvas>
                                <div class="flex gap-4 items-center">
                                    <button onclick="drawFractalTree()" class="bg-cyan-600 hover:bg-cyan-700 text-white px-3 py-1 rounded text-sm"><i class="fa-solid fa-play"></i> å¼€å§‹ç»˜åˆ¶</button>
                                    <div class="flex items-center gap-2 text-xs text-slate-400">
                                        <span>é€’å½’æ·±åº¦:</span>
                                        <input type="range" id="fractal-depth" min="3" max="9" value="7" class="accent-cyan-500 w-16">
                                        <span id="depth-val">7</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. Main Page Logic (Cards, Quiz, Map) ---
        let currentModuleId = 1;
        let currentQuestionIdx = 0;
        let completedModules = new Set();

        const knowledgeDB = {
            1: {
                title: "åŸºç¡€ç§¯æœ¨ (Basics)", color: "blue", badge: "Module 01",
                points: [{title:"å˜é‡",desc:"ç»™æ•°æ®è´´æ ‡ç­¾ã€‚åªèƒ½ç”¨å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼Œä¸èƒ½æ•°å­—å¼€å¤´ã€‚",code:`name = "Alice"\nage = 16`},{title:"I/O",desc:"input() æ°¸è¿œè¿”å›å­—ç¬¦ä¸²ã€‚",code:`print("Hi", name)\nage = int(input())`}],
                quizzes: [{question:"print(type('123')) è¾“å‡º?",options:["int","float","str","Error"],answer:2,explanation:"å¼•å·åŒ…è£¹å³ä¸ºå­—ç¬¦ä¸²ã€‚"},{question:"é”™è¯¯çš„å˜é‡å?",options:["my_name","user2","2nd_place","_score"],answer:2,explanation:"å˜é‡åä¸èƒ½ä»¥æ•°å­—å¼€å¤´ã€‚"}]
            },
            2: {
                title: "é€»è¾‘æ§åˆ¶ (Logic)", color: "purple", badge: "Module 02",
                points: [{title:"If-Else",desc:"è®°å¾—å†’å·å’Œç¼©è¿›ã€‚",code:`if score>=60:\n    pass`},{title:"é€»è¾‘è¿ç®—",desc:"and, or, not",code:`if a>0 and b>0:`}],
                quizzes: [{question:"True and False ç»“æœ?",options:["True","False","Error","None"],answer:1,explanation:"and è¦æ±‚ä¸¤è¾¹éƒ½çœŸã€‚"},{question:"Python ç¼©è¿›é€šå¸¸æ˜¯?",options:["1æ ¼","2æ ¼","4æ ¼","8æ ¼"],answer:2,explanation:"PEP8 æ¨è 4 ç©ºæ ¼ã€‚"}]
            },
            3: {
                title: "æ•°æ®å®¹å™¨ (Containers)", color: "amber", badge: "Module 03",
                points: [{title:"List vs Tuple",desc:"List[]å¯æ”¹ï¼ŒTuple()ä¸å¯æ”¹ã€‚",code:`ls=[1,2]\ntp=(1,2)`},{title:"Dict",desc:"é”®å€¼å¯¹ {k:v}",code:`d={'a':1}\nprint(d['a'])`}],
                quizzes: [{question:"é€šè¿‡'åå­—'æŸ¥'åˆ†æ•°'ç”¨ä»€ä¹ˆ?",options:["List","Tuple","Dict","Set"],answer:2,explanation:"å­—å…¸é€‚åˆ Key-Value æŸ¥æ‰¾ã€‚"},{question:"å®šä¹‰åˆ—è¡¨ç”¨?",options:["()","[]","{}","<>"],answer:1,explanation:"[] æ˜¯åˆ—è¡¨ã€‚"}]
            },
            4: {
                title: "å‡½æ•°é­”æ³• (Functions)", color: "emerald", badge: "Module 04",
                points: [{title:"å®šä¹‰",desc:"def å…³é”®å­—ã€‚",code:`def add(a,b):\n return a+b`}],
                quizzes: [{question:"def f(a, b=10) è°ƒç”¨ f(5), bæ˜¯?",options:["0","5","10","None"],answer:2,explanation:"ä½¿ç”¨é»˜è®¤å‚æ•°ã€‚"},{question:"å®šä¹‰å‡½æ•°å…³é”®å­—?",options:["fun","def","define","func"],answer:1,explanation:"def"}]
            },
            5: {
                title: "å¾ªç¯ä¸ç®—æ³• (Loops)", color: "rose", badge: "Module 05",
                points: [{title:"For",desc:"éå†åºåˆ—ã€‚",code:`for i in range(3):`},{title:"While",desc:"æ¡ä»¶å¾ªç¯ã€‚",code:`while n>0:`}],
                quizzes: [{question:"range(1,4) ç”Ÿæˆ?",options:["1,2,3,4","0,1,2,3","1,2,3","2,3,4"],answer:2,explanation:"å·¦é—­å³å¼€ï¼Œä¸å«4ã€‚"},{question:"è·³å‡ºå¾ªç¯ç”¨?",options:["stop","break","continue","exit"],answer:1,explanation:"break"}]
            }
        };

        function openModal(id) {
            currentModuleId = id; currentQuestionIdx = 0;
            const data = knowledgeDB[id];
            document.getElementById('modal-title').innerText = data.title;
            const badge = document.getElementById('modal-badge');
            badge.innerText = data.badge; badge.className = `px-3 py-1 rounded-full text-xs font-bold bg-${data.color}-100 text-${data.color}-600`;
            document.getElementById('modal-points').innerHTML = data.points.map(p => `<div class="border-l-4 border-${data.color}-500 pl-4"><h3 class="font-bold text-slate-700">${p.title}</h3><p class="text-sm text-slate-600 mb-1">${p.desc}</p><pre><code class="language-python text-xs rounded">${p.code}</code></pre></div>`).join('');
            hljs.highlightAll();
            renderQuiz();
            document.getElementById('modal-overlay').classList.remove('hidden');
            document.getElementById('modal-content').classList.add('modal-enter');
            document.body.style.overflow = 'hidden';
        }

        function renderQuiz() {
            const data = knowledgeDB[currentModuleId];
            if (currentQuestionIdx >= data.quizzes.length) {
                document.getElementById('quiz-question').classList.add('hidden');
                document.getElementById('quiz-options').classList.add('hidden');
                document.getElementById('quiz-counter').classList.add('hidden');
                document.getElementById('quiz-completion').classList.remove('hidden');
                markModuleComplete(currentModuleId);
                return;
            }
            document.getElementById('quiz-completion').classList.add('hidden');
            document.getElementById('quiz-question').classList.remove('hidden');
            document.getElementById('quiz-options').classList.remove('hidden');
            document.getElementById('quiz-counter').classList.remove('hidden');
            
            const q = data.quizzes[currentQuestionIdx];
            document.getElementById('quiz-question').innerText = q.question;
            document.getElementById('quiz-counter').innerText = `${currentQuestionIdx+1}/${data.quizzes.length}`;
            document.getElementById('quiz-options').innerHTML = q.options.map((o,i)=>`<div class="quiz-option p-3 rounded-lg bg-white font-medium text-slate-600 text-sm flex justify-between" onclick="checkAnswer(this,${i})"><span>${o}</span><i class="fa-regular fa-circle text-slate-300 status"></i></div>`).join('');
            document.getElementById('quiz-feedback').classList.add('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            document.getElementById('quiz-options').classList.remove('answered');
        }

        function checkAnswer(el, idx) {
            const opts = document.getElementById('quiz-options');
            if(opts.classList.contains('answered')) return;
            opts.classList.add('answered');
            
            const data = knowledgeDB[currentModuleId].quizzes[currentQuestionIdx];
            const feedback = document.getElementById('quiz-feedback');
            
            if(idx === data.answer) {
                el.classList.add('quiz-correct');
                el.querySelector('.status').className="fa-solid fa-circle-check text-green-600";
                feedback.innerHTML = `<span class="text-green-700 font-bold">æ­£ç¡®!</span> ${data.explanation}`;
                feedback.className = "mt-4 p-3 rounded-lg text-sm bg-green-50 text-green-700";
            } else {
                el.classList.add('quiz-wrong');
                el.querySelector('.status').className="fa-solid fa-circle-xmark text-red-600";
                feedback.innerHTML = `<span class="text-red-700 font-bold">é”™è¯¯.</span> ${data.explanation}`;
                feedback.className = "mt-4 p-3 rounded-lg text-sm bg-red-50 text-red-700";
                const correctEl = opts.children[data.answer];
                correctEl.classList.add('quiz-correct');
                correctEl.querySelector('.status').className="fa-solid fa-circle-check text-green-600";
            }
            feedback.classList.remove('hidden');
            if(currentQuestionIdx < knowledgeDB[currentModuleId].quizzes.length) document.getElementById('next-btn').classList.remove('hidden');
        }
        
        function nextQuestion() { currentQuestionIdx++; renderQuiz(); }
        function markModuleComplete(id) {
            if(completedModules.has(id)) return;
            completedModules.add(id);
            const card = document.getElementById(`module-card-${id}`);
            if(card) {
                const data = knowledgeDB[id];
                card.querySelector('.icon-box').className = `icon-box bg-${data.color}-500 text-white shadow-lg scale-110 border-4 border-${data.color}-200`;
                card.querySelector('.footer-text').innerHTML = '<span class="text-green-600 font-bold">å·²æŒæ¡ âœ¨</span>';
                document.querySelector(`.dot-${id}`)?.classList.add('bg-green-500');
            }
        }
        function closeModal() { document.getElementById('modal-overlay').classList.add('hidden'); document.body.style.overflow='auto'; }
        function showMarathon() {
            document.getElementById('map-view').classList.add('hidden');
            document.getElementById('marathon-view').classList.remove('hidden');
            const hb = document.getElementById('header-badge'); hb.innerText="ğŸ† æœ€ç»ˆæŒ‘æˆ˜æ¨¡å¼"; hb.className="text-xs font-semibold text-orange-600 bg-orange-50 px-3 py-1.5 rounded-full border border-orange-100";
            window.scrollTo(0,0);
        }
        function hideMarathon() {
            document.getElementById('marathon-view').classList.add('hidden');
            document.getElementById('map-view').classList.remove('hidden');
            const hb = document.getElementById('header-badge'); hb.innerText="ğŸ“š çŸ¥è¯†ç‚¹å¤ä¹ æ¨¡å¼"; hb.className="text-xs font-semibold text-indigo-600 bg-indigo-50 px-3 py-1.5 rounded-full border border-indigo-100";
        }

        // --- 2. Hackathon Console Logic (Merged) ---
        const codeSnippets = {
            adventure: `# ä»»åŠ¡1: æ–‡å­—å†’é™©æ¸¸æˆ\n# æ ¸å¿ƒçŸ¥è¯†: printè¾“å‡º, inputè¾“å…¥, ifæ¡ä»¶åˆ¤æ–­, whileå¾ªç¯\n\ndef start_adventure():\n    print("--- æ¬¢è¿æ¥åˆ°è¿·é›¾æ£®æ— ---")\n    print("ä½ ç«™åœ¨å²”è·¯å£ã€‚")\n\n    while True:\n        # 1. è·å–ç©å®¶æŒ‡ä»¤ (è½¬ä¸ºå°å†™)\n        choice = input("ä½ è¦å¾€å·¦(left)è¿˜æ˜¯å¾€å³(right)? ").lower()\n\n        # 2. æ ¹æ®æŒ‡ä»¤é€šè¿‡ if-elif-else è§¦å‘ä¸åŒå‰§æƒ…\n        if choice == "left":\n            print("ä½ é‡åˆ°äº†ä¸€åªå‹å¥½çš„å²è±å§†ï¼")\n            print("å®ƒé€ç»™ä½ ä¸€æŠŠé­”æ³•å‰‘ã€‚")\n            print("æ¸¸æˆèƒœåˆ©ï¼")\n            break  # ç»“æŸå¾ªç¯ï¼Œæ¸¸æˆç»“æŸ\n\n        elif choice == "right":\n            print("å“å‘€ï¼è¿™é‡Œæ˜¯ä¸€ä¸ªé™·é˜±ã€‚")\n            print("ä½ æ‰è¿›å‘é‡Œäº†... æ¸¸æˆç»“æŸã€‚")\n            break\n\n        else:\n            # å¤„ç†æ— æ•ˆè¾“å…¥\n            print("æ— æ•ˆæŒ‡ä»¤ï¼Œè¯·è¾“å…¥ left æˆ– rightã€‚")\n\n# å¼€å§‹è¿è¡Œ\nstart_adventure()`,
            
            manager: `# ä»»åŠ¡2: ç¤¾å›¢å°ç®¡å®¶\n# æ ¸å¿ƒçŸ¥è¯†: å­—å…¸(Dictionary), å‡½æ•°(Function), å¢åˆ æ”¹æŸ¥\n\n# ä½¿ç”¨å­—å…¸å­˜å‚¨æ•°æ®: {å§“å: èŒåŠ¡}\nmembers = {\n    "Alice": "ç¤¾é•¿",\n    "Bob": "å®£ä¼ å§”å‘˜"\n}\n\ndef add_member(name, role):\n    """æ·»åŠ æ–°æˆå‘˜"""\n    if name in members:\n        print(f"é”™è¯¯: {name} å·²ç»åœ¨åå•é‡Œäº†ã€‚")\n    else:\n        members[name] = role  # å­—å…¸æ–°å¢/ä¿®æ”¹è¯­æ³•\n        print(f"æˆåŠŸæ·»åŠ : {name} (èŒåŠ¡: {role})")\n\ndef delete_member(name):\n    """åˆ é™¤æˆå‘˜"""\n    if name in members:\n        del members[name]  # åˆ é™¤é”®å€¼å¯¹\n        print(f"å·²ç§»é™¤: {name}")\n    else:\n        print(f"é”™è¯¯: æ‰¾ä¸åˆ° {name}")\n\ndef show_all():\n    """æ˜¾ç¤ºæ‰€æœ‰æˆå‘˜"""\n    print("--- å½“å‰æˆå‘˜åˆ—è¡¨ ---")\n    # éå†å­—å…¸çš„é”®å’Œå€¼\n    for name, role in members.items():\n        print(f"å§“å: {name} | èŒåŠ¡: {role}")\n\n# --- æµ‹è¯•åŒº (å¯¹åº”å³ä¾§æŒ‰é’®) ---\n# add_member("Charlie", "æŠ€æœ¯")\n# show_all()`,
            
            game: `# ä»»åŠ¡3: ä¸ç”µè„‘åšå¼ˆ (äº•å­—æ£‹ AI)\n# æ ¸å¿ƒçŸ¥è¯†: åˆ—è¡¨(List), ç´¢å¼•(Index), é€»è¾‘åˆ¤æ–­\n\n# 1. åˆå§‹åŒ–æ£‹ç›˜ (9ä¸ªç©ºæ ¼çš„åˆ—è¡¨)\nboard = [" "] * 9\n\ndef make_move(index, player):\n    """åœ¨æŒ‡å®šä½ç½®ä¸‹æ£‹"""\n    board[index] = player\n    print_board()\n\ndef check_winner(player):\n    """åˆ¤æ–­æ˜¯å¦è·èƒœ"""\n    # æ‰€æœ‰å¯èƒ½çš„è¿çº¿ç»„åˆ (è¡Œã€åˆ—ã€å¯¹è§’çº¿)\n    wins = [\n        (0,1,2), (3,4,5), (6,7,8), # æ¨ªå‘\n        (0,3,6), (1,4,7), (2,5,8), # çºµå‘\n        (0,4,8), (2,4,6)           # å¯¹è§’çº¿\n    ]\n    for a, b, c in wins:\n        # å¦‚æœä¸‰ä¸ªä½ç½®éƒ½æ˜¯è¯¥ç©å®¶çš„æ£‹å­\n        if board[a] == board[b] == board[c] == player:\n            return True\n    return False\n\ndef computer_turn():\n    """ç”µè„‘å›åˆ (ç®€å•çš„éšæœºç­–ç•¥)"""\n    import random\n    # æ‰¾å‡ºæ‰€æœ‰ç©ºä½\n    empty_slots = [i for i, x in enumerate(board) if x == " "]\n    if empty_slots:\n        move = random.choice(empty_slots)\n        make_move(move, "O")\n        if check_winner("O"):\n            print("ç”µè„‘è·èƒœï¼")`,
            
            fractal: `# ä»»åŠ¡4: åˆ†å½¢è‰ºæœ¯ç”»å»Š\n# æ ¸å¿ƒçŸ¥è¯†: Turtleç»˜å›¾, é€’å½’å‡½æ•° (Recursion)\n\nimport turtle\n\nt = turtle.Turtle()\nt.left(90)  # ç®­å¤´æœä¸Š\n\ndef draw_tree(length, depth):\n    """\n    ç»˜åˆ¶åˆ†å½¢æ ‘çš„é€’å½’å‡½æ•°\n    length: å½“å‰æ ‘æé•¿åº¦\n    depth:  å½“å‰é€’å½’æ·±åº¦ (è¿˜èƒ½åˆ†å‰å‡ æ¬¡)\n    """\n    # 1. é€’å½’ç»ˆæ­¢æ¡ä»¶ (æ·±åº¦ä¸º0æ—¶åœæ­¢)\n    if depth == 0:\n        return\n\n    # 2. ç”»æ ‘å¹²\n    t.forward(length)\n    \n    # 3. ç”»å·¦åˆ†æ”¯ (é•¿åº¦å˜çŸ­ï¼Œæ·±åº¦å‡1)\n    t.left(20)\n    draw_tree(length * 0.7, depth - 1)\n    \n    # 4. ç”»å³åˆ†æ”¯\n    t.right(40) # å¾€å›è½¬40åº¦ (å·¦20 -> å³20)\n    draw_tree(length * 0.7, depth - 1)\n    \n    # 5. å›æº¯ (å›åˆ°åˆ†å‰ç‚¹ï¼Œæ¢å¤è§’åº¦)\n    t.left(20)\n    t.backward(length)\n\n# å¼€å§‹ç»˜åˆ¶ (é•¿åº¦100ï¼Œæ·±åº¦7)\ndraw_tree(100, 7)\nturtle.done()`
        };

        let currentTab = 'adventure';
        // Adventure State
        let advState='start'; const advLog=document.getElementById('adventure-log'); const advInput=document.getElementById('adventure-input');
        // Manager State
        let mgrData={"Alice":"ç¤¾é•¿"}; const mgrOut=document.getElementById('mgr-output');
        // Game State
        let board=["","","","","","","","",""]; let gameActive=true;

        function openHackathonModal(tab, showCode = true) {
            document.getElementById('hackathon-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            const codePanel = document.getElementById('code-panel');
            const demoPanel = document.getElementById('demo-panel');
            
            if (showCode) {
                // Teacher/Full Mode: Show Code, Demo half width
                codePanel.classList.remove('hidden');
                demoPanel.classList.remove('md:w-full');
                demoPanel.classList.add('md:w-1/2');
            } else {
                // Student/Demo Only Mode: Hide Code, Demo full width
                codePanel.classList.add('hidden');
                demoPanel.classList.remove('md:w-1/2');
                demoPanel.classList.add('md:w-full');
            }

            switchTab(tab || 'adventure');
        }

        function closeHackathonModal() {
            document.getElementById('hackathon-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function switchTab(tabId) {
            currentTab = tabId;
            document.querySelectorAll('nav button').forEach(b => b.className = "tab-inactive w-full text-left px-3 py-2 rounded-lg border flex items-center gap-3");
            const btn = document.getElementById(`tab-${tabId}`);
            if(btn) btn.className = "tab-active w-full text-left px-3 py-2 rounded-lg border flex items-center gap-3 shadow-lg shadow-blue-900/20";
            
            document.getElementById('code-filename').innerText = `${tabId}_task.py`;
            const codeEl = document.getElementById('code-display');
            codeEl.textContent = codeSnippets[tabId];
            hljs.highlightElement(codeEl);

            ['adventure','manager','game','fractal'].forEach(id => document.getElementById(`demo-${id}`).classList.add('hidden'));
            const demo = document.getElementById(`demo-${tabId}`);
            demo.classList.remove('hidden');
            if(tabId!=='game' && tabId!=='fractal') demo.classList.add('flex'); // restore flex for text based
            
            resetCurrentDemo();
        }

        function resetCurrentDemo() {
            if(currentTab==='adventure') {
                advLog.innerHTML = ''; advAddMsg("--- æ¬¢è¿æ¥åˆ°è¿·é›¾æ£®æ— (v1.0) ---","text-blue-400"); advAddMsg("è¯·è¾“å…¥ 'start' å¼€å§‹æ¸¸æˆã€‚","text-slate-500"); advState='start'; advInput.value='';
            }
            if(currentTab==='manager') {
                mgrData={"Alice":"ç¤¾é•¿","Bob":"å®£ä¼ å§”å‘˜"}; mgrOut.textContent=">>> ç³»ç»Ÿåˆå§‹åŒ–å®Œæ¯•ã€‚\n>>> members = {'Alice':'ç¤¾é•¿','Bob':'å®£ä¼ å§”å‘˜'}";
            }
            if(currentTab==='game') {
                board.fill(""); gameActive=true; document.querySelectorAll('.ttt-cell').forEach(c=>{c.innerText="";c.classList.remove('text-blue-500','text-red-500')}); document.getElementById('game-status').innerText="ç©å®¶(X) vs ç”µè„‘(O)";
            }
            if(currentTab==='fractal') {
                const cvs=document.getElementById('fractal-canvas'); cvs.getContext('2d').clearRect(0,0,cvs.width,cvs.height);
            }
        }

        // Adventure Logic
        function advAddMsg(t,c="text-slate-300"){const d=document.createElement('div');d.className=c;d.innerText=t;advLog.appendChild(d);advLog.scrollTop=advLog.scrollHeight;}
        advInput.addEventListener('keypress',e=>{
            if(e.key==='Enter'){
                const cmd=advInput.value.trim().toLowerCase(); advAddMsg(`>>> ${cmd}`,"text-green-500"); advInput.value='';
                if(cmd==='start'){advState='gate';advAddMsg("ä½ ç«™åœ¨å²”è·¯å£ã€‚è¦å¾€å·¦(left)è¿˜æ˜¯å¾€å³(right)?","text-white");}
                else if(advState==='gate'){
                    if(cmd==='left'){advState='end';advAddMsg("ä½ é‡åˆ°äº†ä¸€åªå‹å¥½çš„å²è±å§†ï¼å®ƒé€ä½ ä¸€æŠŠé­”æ³•å‰‘ã€‚æ¸¸æˆèƒœåˆ©ï¼(è¾“å…¥ start é‡æ¥)","text-green-400");}
                    else if(cmd==='right'){advState='end';advAddMsg("å“å‘€ï¼è¿™é‡Œæ˜¯ä¸€ä¸ªé™·é˜±ã€‚ä½ æ‰è¿›å‘é‡Œäº†... æ¸¸æˆç»“æŸã€‚(è¾“å…¥ start é‡æ¥)","text-red-400");}
                    else advAddMsg("æ— æ•ˆæŒ‡ä»¤ï¼Œè¯·è¾“å…¥ left æˆ– rightã€‚");
                }
                else if(cmd==='start' && advState==='end') {
                    advState='gate';advAddMsg("ä½ ç«™åœ¨å²”è·¯å£ã€‚è¦å¾€å·¦(left)è¿˜æ˜¯å¾€å³(right)?","text-white");
                }
                else advAddMsg("æ— æ•ˆæŒ‡ä»¤ã€‚");
            }
        });

        // Manager Logic
        function mgrLog(t){mgrOut.textContent+="\n"+t; mgrOut.parentElement.scrollTop=mgrOut.parentElement.scrollHeight;}
        function mgrAdd(){const n=document.getElementById('mgr-add-name').value;const r=document.getElementById('mgr-add-role').value; if(n){mgrData[n]=r;mgrLog(`>>> add_member('${n}', '${r}')\næˆåŠŸæ·»åŠ : ${n} (èŒåŠ¡: ${r})`);}else mgrLog("é”™è¯¯: åå­—ä¸èƒ½ä¸ºç©º");}
        function mgrDelete(){const n=document.getElementById('mgr-del-name').value; if(mgrData[n]){delete mgrData[n];mgrLog(`>>> delete_member('${n}')\nå·²ç§»é™¤: ${n}`);}else mgrLog(`é”™è¯¯: æ‰¾ä¸åˆ° ${n}`);}
        function mgrShow(){mgrLog(">>> show_all()\n--- å½“å‰æˆå‘˜åˆ—è¡¨ ---\n"+Object.entries(mgrData).map(([k,v])=>`å§“å: ${k} | èŒåŠ¡: ${v}`).join('\n'));}

        // Game Logic
        function gameMove(i){
            if(!gameActive||board[i]!=="")return;
            board[i]="X"; updateBoard(i,"X");
            if(checkWin("X")){endGame("ç©å®¶è·èƒœ! ğŸ‰","text-blue-400");return;}
            setTimeout(()=>{
                if(!gameActive)return;
                const empties=board.map((v,k)=>v===""?k:null).filter(v=>v!==null);
                if(empties.length===0){endGame("å¹³å±€!","text-slate-400");return;}
                const m=empties[Math.floor(Math.random()*empties.length)];
                board[m]="O"; updateBoard(m,"O");
                if(checkWin("O"))endGame("ç”µè„‘è·èƒœ! ğŸ¤–","text-red-400");
            },300);
        }
        function updateBoard(i,p){const c=document.querySelectorAll('.ttt-cell')[i];c.innerText=p;c.classList.add(p==="X"?"text-blue-500":"text-red-500");}
        function checkWin(p){const w=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];return w.some(c=>c.every(x=>board[x]===p));}
        function endGame(t,c){gameActive=false;const s=document.getElementById('game-status');s.innerText=t;s.className=c+" font-bold";}

        // Fractal Logic
        function drawFractalTree(){
            const ctx=document.getElementById('fractal-canvas').getContext('2d');
            const depth=parseInt(document.getElementById('fractal-depth').value); document.getElementById('depth-val').innerText=depth;
            ctx.clearRect(0,0,300,300); ctx.strokeStyle='#06b6d4'; ctx.lineWidth=1;
            
            // Recursive function now matches the Python logic: draw_tree(length, depth)
            function draw_tree_js(x, y, length, angle, current_depth){
                // 1. Base case: depth == 0
                if(current_depth===0)return;

                const x2=x+length*Math.cos(angle*Math.PI/180); 
                const y2=y-length*Math.sin(angle*Math.PI/180);
                
                ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(x2,y2);ctx.stroke();
                
                // 2. Recursive steps
                setTimeout(()=>{
                    // Left branch
                    draw_tree_js(x2,y2,length*0.75, angle-20, current_depth-1);
                    // Right branch
                    draw_tree_js(x2,y2,length*0.75, angle+20, current_depth-1);
                },20);
            }
            // Start drawing
            draw_tree_js(150,300,80,90,depth);
        }

        // Escape Key Handling
        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") {
                if(!document.getElementById('hackathon-modal').classList.contains('hidden')) closeHackathonModal();
                else if(!document.getElementById('modal-overlay').classList.contains('hidden')) closeModal();
            }
        });
    </script>
</body>
</html>